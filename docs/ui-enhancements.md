# UI 與互動優化紀錄

> 最後更新：2025-11-27

此文件彙整近期於前端日曆視圖（`frontend/src`）所進行的主要修正與體驗優化項目，方便後續維護與溝通。

---

## 1. 月視圖滾輪與事件顯示
- **恢復滾輪切換月份**：重新掛載 `wheel` 事件，僅在 `dayGridMonth` 且非 Ctrl + 滾輪時切換月份，保留自然捲動頁面。
- **固定每日最多兩筆顯示**：改用 `dayMaxEvents=2`，超出以「+N 更多」呈現，避免日期格被撐高。

## 2. 事件卡片呈現
- **雙行資訊**：保留「使用者名稱 + 行程標題」的兩行排版，名稱字級上調至 11px，資訊更清楚。
- **滑動過渡**：事件詳情浮層（`EventDetailModal`）加上 top/left 轉場與 `cubic-bezier` 曲線，連續點擊不同事件時，彈窗會平滑滑移到新位置。
- **外部點擊關閉**：錨定狀態下不再顯示遮罩，但會監聽全域 `pointerdown`，只要點擊卡片以外（含空白處）即自動關閉。

## 3. 事件詳情定位
- **錨點來源**：`CalendarView` 在 `eventClick` 時使用 `arg.el.getBoundingClientRect()` 取得事件 DOM 位置，無論在主格或 `+更多` popover 內都能正確錨定。
- **Popover 保持開啟**：點擊 `+更多` 清單內事件時阻止冒泡，避免 FullCalendar 預設關閉 popover。

## 4. 「+更多」彈出視窗
- **固定定位與邊界檢查**：`moreLinkClick` 會多次量測日期格與視窗大小，決定貼左或貼右，並在上下空間不足時自動往上移動，確保不被視窗裁切。
- **浮動樣式**：新增 `.fc-more-popover-floating` 樣式，設定最大寬高、圓角、陰影與滾動區，改善過去「當天多筆行程破版」問題。

## 5. 其他細節
- **外觀一致性**：事件詳情與 popover 加入淡入動畫與加強版陰影，視覺更接近 Google Calendar。
- **程式碼可維護性**：將 UI 調校集中於 `CalendarView.tsx`、`EventDetailModal.tsx` 與 `index.css`，並以 `docs/ui-enhancements.md` 記錄，方便追蹤後續變動。

## 6. 2025-11-27 進一步調整
- **自訂「+更多」浮層**：完全取代 FullCalendar 預設 popover，帶入 `hiddenSegs` 事件清單並保留滑動定位；關閉按鈕改為圓型 hover 狀態，體驗更貼近 Google Calendar。
- **月視圖事件 chip**：在 `CalendarView.tsx` 與 `index.css` 新增 `.event-chip` 樣式，姓名與標題改為水平排列，小螢幕（≤1366px）會縮小間距與字級以塞入更多事件，而自訂 popover 維持原本排版。
- **事件 chip 響應式排列**：預設恢復垂直（姓名/標題分行）顯示，當瀏覽器寬度小於 1500px（如 13 吋筆電 1920×1080 下縮放顯示）時自動切換為水平排列，以便在有限寬度中看到更多事件資訊；24 吋桌機則維持原排版。
- **快捷關閉**：`EventDetailModal` 支援 `Esc` 鍵與自訂 popover 內點擊不再關閉，確保從「+更多」點事件時也能看到滑動過場。

---

## 7. 2025-11-27 大型優化更新

本次更新新增多項 Google 日曆風格的功能與體驗優化：

### 7.1 搜尋功能
- **檔案**: `App.tsx`
- **功能**: 在 Header 搜尋框中輸入關鍵字，可即時篩選事件
- **篩選範圍**: 事件標題、使用者名稱、地點
- **新增清除按鈕**: 一鍵清空搜尋內容

### 7.2 空檔查詢 UI
- **檔案**: `components/AvailabilityFinder.tsx`
- **功能**: 視覺化尋找所有選定成員的共同可用時段
- **設定選項**: 
  - 選擇參與者（支援全選/取消全選）
  - 會議時長：30/60/90/120/180 分鐘
  - 查詢範圍：7/14/30 天
- **結果呈現**: 按日期分組顯示可用時段

### 7.3 鍵盤快捷鍵
- **檔案**: `hooks/useKeyboardShortcuts.ts`
- **快捷鍵列表**:
  | 按鍵 | 功能 |
  |------|------|
  | `T` | 回到今天 |
  | `M` | 月視圖 |
  | `W` | 週視圖 |
  | `D` | 日視圖 |
  | `A` | 列表視圖 |
  | `←/→` | 上/下一個時間範圍 |
  | `[` | 切換側邊欄 |
  | `F` | 開啟空檔查詢 |
  | `/` | 聚焦搜尋框 |

### 7.4 快捷鍵說明
- **檔案**: `components/KeyboardShortcutsHelp.tsx`
- **觸發方式**: 點擊 Header 問號按鈕
- **呈現**: 美觀的彈窗列出所有快捷鍵

### 7.5 事件詳情增強
- **檔案**: `components/EventDetailModal.tsx`
- **新增功能**:
  - 複製事件資訊到剪貼簿
  - 「在 Outlook 開啟」連結（建立類似事件）

### 7.6 今日日期動畫
- **檔案**: `index.css`, `components/MiniMonthCalendar.tsx`
- **效果**: 迷你月曆中「今日」顯示脈動光環動畫

### 7.7 週視圖/日視圖優化
- **檔案**: `index.css`
- **改進項目**:
  - 時間指示線加入紅色圓點（Google 日曆風格）
  - 事件內容顯示時間
  - 優化事件標題字重與間距

### 7.8 深色模式
- **檔案**: `index.css`
- **特色**: 自動跟隨系統偏好（`prefers-color-scheme: dark`）
- **覆蓋範圍**: Header、側邊欄、日曆、彈窗、輸入框等

### 7.9 PWA 支援
- **新增檔案**:
  - `public/manifest.json`
  - `public/sw.js`
- **修改檔案**: `index.html`
- **功能**:
  - 可安裝到桌面/手機
  - 離線快取支援
  - Apple 裝置適配

---
如需補充或延伸此文件，建議依照章節繼續追加條列，並標註日期與檔案位置。
